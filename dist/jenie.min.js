/*
	name: jenie
	version: 1.0.8
	author: alexander elias
*/
(function(a,b){'object'==typeof exports&&'undefined'!=typeof module?module.exports=b():'function'==typeof define&&define.amd?define('Jenie',b):a.Jenie=b()})(this,function(){'use strict';function a(){}function b(){}function c(){}function d(){}function f(){}function g(){}function h(){}var j={GET:2,SET:3,toCamelCase:function(U){return'Array'===U.constructor.name&&(U=U.join('-')),U.replace(/-[a-z]/g,function(V){return V[1].toUpperCase()})},toDashCase:function(U){return'Array'===U.constructor.name&&(U=U.join('')),U.replace(/[A-Z]/g,function(V){return'-'+V.toLowerCase()})},interact:function(U,V,W,X){for(var aa,Y=W.split('.'),Z=Y.length-1,$=V,_=0;_<Z;_++){if(aa=Y[_],null===$[aa]||void 0===$[aa]){if(U===this.GET)return;U===this.SET&&($[aa]={})}$=$[aa]}if(U===this.GET)return $[Y[Z]];return U===this.SET?($[Y[Z]]=X,V):void 0},getByPath:function(U,V){return this.interact(this.GET,U,V)},setByPath:function(U,V,W){return this.interact(this.SET,U,V,W)}},k=j;a.prototype.ins=function(U,V,W,X,Y){('Object'===Y.constructor.name||'Array'===Y.constructor.name)&&(Y=this.observe(Y,V,W+X,!0)),U=Object.defineProperty(U,X,this.descriptor(W+X,Y,V)),V&&V(W.slice(0,-1),U)},a.prototype.del=function(U,V,W,X){'Object'===U.constructor.name?(delete U[X],V&&V(W+X,void 0)):'Array'===U.constructor.name&&(U.splice(X,1),V&&V(W.slice(0,-1),U))},a.prototype.each=function(U,V){if(!U)throw new Error('not a collection');else if('Array'===U.constructor.name){if(0===U.length)return;for(W=0;W<U.length;W++)V(U[W],W)}else if('Object'===U.constructor.name){if(0===Object.keys(U).length)return;for(var W in U)V(U[W],W)}},a.prototype.descriptor=function(U,V,W){return{configurable:!0,enumerable:!0,get:function(){return V},set:function(X){V=X,W(U,V)}}},a.prototype.observe=function(U,V,W){var Z,X=this,Y={};return W=W?W+='.':'',Z='Object'===U.constructor.name?{}:[],Y.ins={value:X.ins.bind(X,Z,V,W)},Y.del={value:X.del.bind(X,Z,V,W)},X.each(U,function($,_){null!==$&&void 0!==$&&('Object'===$.constructor.name||'Array'===$.constructor.name)&&($=X.observe($,V,W+_)),Y[_]=X.descriptor(W+_,$,V)}),Object.defineProperties(Z,Y)},a.prototype.get=function(U){return k.getByPath(this.data,U)},a.prototype.set=function(U,V){return k.setByPath(this.data,U,V)},a.prototype.setup=function(U,V){this.data=this.observe(U,V)},a.prototype.create=function(U){var V=this;return U=U||{},V.data=U.data||{},V};var n={sViewElement:'j-view',sPrefix:'(data-)?j-',sValue:'(data-)?j-value',sFor:'(data-)?j-for-(.*?)=',sAccepts:'(data-)?j-',sRejects:'^w+(-w+)+|^iframe|^object|^script',rPath:/\s?\|(.*?)$/,rPrefix:/(data-)?j-/,rValue:/(data-)?j-value/,rModifier:/^(.*?)\|\s?/,rFor:/(data-)?j-for-(.*?)=/,rAccepts:/(data-)?j-/,rRejects:/^\w+(-\w+)+|^iframe|^object|^script/,rAttributeAccepts:/(data-)?j-/,rElementAccepts:/(data-)?j-/,rElementRejectsChildren:/(data-)?j-each/,rElementRejects:/^\w+(-\w+)+|^iframe|^object|^script/},o=j;b.prototype.attributes={on:function(){var U=this;if('function'==typeof U.data){var V=U.attribute.cmds[1],W=U.attribute.opts[U.attribute.opts.length-1];U.element.removeEventListener(V,U.listeners[W],!1),U.listeners[W]=function(X){X.preventDefault(),U.data.call(U,X)},U.element.addEventListener(V,U.listeners[W],!1)}},each:function(){var U=this;U.container||(U.container=document.createElement('div')),U.clone||(U.clone=U.element.cloneNode(!0)),U.children||(U.children=[]);var V=U.attribute.cmds.slice(1).join('.'),W=new RegExp('(((data-)?j(-(\\w)+)+="))'+V+'(((\\.(\\w)+)+)?")','g');if(U.data.forEach(function(X,Y){U.container.innerHTML=U.clone.cloneNode(!0).innerHTML.replace(W,'$1'+U.attribute.path+'.'+Y.toString()+'$6'),U.element.children[Y]?U.element.replaceChild(U.container.children[0],U.element.children[Y]):U.element.children.length<U.data.length&&U.element.appendChild(U.container.children[0])}),U.element.children.length>U.data.length)for(;U.element.children.length>U.data.length;)U.element.removeChild(U.element.children[U.element.children.length-1]);U.children.forEach(function(X,Y){U.children.slice(Y,1),U.binder._view.remove(X.path,X.index)}),U.binder._view.set(U.element.getElementsByTagName('*'),function(X,Y,Z){return X.binder=U.binder,X.data=U.binder._model.get(X.attribute.path),X.render(),U.children.push({path:Y,index:Z}),X})},value:function(){var U=this;if(('checkbox'===U.element.type||'radio'===U.element.type)&&(U.element.value=U.data,U.element.checked=U.data),!U.isChangeEventAdded){U.isChangeEventAdded=!0;var V=function(W){if(!U.isChanging){U.isChanging=!0;var X=W.target,Y='checkbox'===X.type||'radio'===X.type?X.checked:X.value;U.binder._model.set(U.attribute.path,Y),U.isChanging=!1}};U.element.addEventListener('change',V),U.element.addEventListener('keyup',V)}},html:function(){this.element.innerHTML=this.data},css:function(){var U=this.data;1<this.attribute.cmds.length&&(U=this.attribute.cmds.slice(1).join('-')+': '+U+';'),this.element.style.cssText+=U},class:function(){var U=this.attribute.cmds.slice(1).join('-');this.element.classList.toggle(U,this.data)},text:function(){this.element.innerText=this.data},enable:function(){this.element.disabled=!this.data},disable:function(){this.element.disabled=this.data},show:function(){this.element.hidden=!this.data},hide:function(){this.element.hidden=this.data},write:function(){this.element.readOnly=!this.data},read:function(){this.element.readOnly=this.data},selected:function(){this.element.selectedIndex=this.data},default:function(){var U=o.toCamelCase(this.attribute.cmds);o.setByPath(this.element,U,this.data)}},b.prototype.render=function(){var U=this;return U.attributes[U.attribute.cmds[0]in U.attributes?U.attribute.cmds[0]:'default'].call(U),U},b.prototype.create=function(U){var V=this;return V.attribute=U.attribute,V.element=U.element,V.binder=U.binder,V.isChangeEventAdded=!1,V.isChanging=!1,V.isNew=!0,V.listeners={},V._data,V.clone,Object.defineProperty(V,'data',{configurable:!0,enumerable:!0,get:function(){return V.attribute.modifiers.forEach(function(W){V._data=V.binder.modifiers[W].call(V._data)}),V._data},set:function(W){V._data=W}}),V};var q=n,s=function(U){return new b().create(U)},t=q.rPath,u=q.rPrefix,v=q.rModifier,w=q.rAttributeAccepts,x=q.rElementAccepts,y=q.rElementRejects,z=q.rElementRejectsChildren;c.prototype.glance=function(U){return U.outerHTML.replace(/(\/)?>.*$/,'').replace(/^</,'')},c.prototype.eachElement=function(U,V){var W,X,Y;for(Y=0;Y<U.length;Y++)W=U[Y],X=this.glance(W),y.test(X)?Y+=W.children.length:z.test(X)?(Y+=W.children.length,V(W)):x.test(X)&&V(W)},c.prototype.eachAttribute=function(U,V){var X,Y,W=U.attributes;for(Y=0;Y<W.length;Y++)X={},X.name=W[Y].name,X.value=W[Y].value,w.test(X.name)&&(X.path=X.value.replace(t,''),X.opts=X.path.split('.'),X.command=X.name.replace(u,''),X.cmds=X.command.split('-'),X.modifiers=-1===X.value.indexOf('|')?[]:X.value.replace(v,'').split(' '),V(X))},c.prototype.units=function(U){return this.data[U]||[]},c.prototype.paths=function(){return Object.keys(this.data)},c.prototype.setup=function(U,V){var W=this;return W.eachElement(U,function(X){W.eachAttribute(X,function(Y){Y.path in W.data||(W.data[Y.path]=[]),W.data[Y.path].push(V(s({element:X,attribute:Y})))})}),W},c.prototype.set=function(U,V){var W=this;return W.eachElement(U,function(X){W.eachAttribute(X,function(Y){Y.path in W.data||(W.data[Y.path]=[]),W.data[Y.path].push(V(s({element:X,attribute:Y}),Y.path,W.data[Y.path].length-1))})}),W},c.prototype.remove=function(U,V){var W=this;return U in W.data&&(W.data[U].splice(V,1),0===W.data[U].length&&delete W.data[U]),W},c.prototype.create=function(U){var V=this;return U=U||{},V.data=U.data||{},V};var B=function(U){return new a().create(U)},C=function(U){return new c().create(U)};d.prototype.create=function(U,V){var W=this;return Object.defineProperties(W,{name:{value:U.name},modifiers:{value:U.modifiers||{}},collection:{value:U.model||{}},_view:{value:C()},_model:{value:B()},view:{enumerable:!0,get:function(){return W._view.data}},model:{enumerable:!0,get:function(){return W._model.data}},elements:{get:function(){return(U.view.shadowRoot||U.view).querySelectorAll('*')}}}),W._model.setup(W.collection,function(X,Y){W._view.units(X).forEach(function(Z){Z.data=Y,Z.render()})}),W._view.setup(W.elements,function(X){return X.binder=W,X.data=W._model.get(X.attribute.path),X.render(),X}),V&&V.call(W),W};var D=function(U,V){return new d().create(U,V)},E='0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz'.split(''),H=function(){var V=[],W;V[8]=V[13]=V[18]=V[23]='-',V[14]='4';for(var X=0;36>X;X++)V[X]||(W=0|16*Math.random(),V[X]=E[19==X?8|3&W:W]);return V.join('')};f.prototype.comment=function(U){if('function'!=typeof U)throw new Error('Comment must be a function');var V=/\/\*!?(?:\@preserve)?[ \t]*(?:\r\n|\n)([\s\S]*?)(?:\r\n|\n)\s*\*\//,W=V.exec(U.toString());if(!W)throw new Error('Comment missing');return W[1]},f.prototype.dom=function(U){var V=document.createElement('div');return V.innerHTML=U,V.children[0]},f.prototype._template=function(U){return'Function'===U.constructor.name?(U=this.comment(U),U=this.dom(U)):'String'===U.constructor.name&&(/<|>/.test(U)?U=this.dom(U):U=this.currentScript.ownerDocument.querySelector(U)),U},f.prototype.define=function(U){var V,W;for(V in U)'name'===V?(W=U.name,delete U.name):U[V]={value:U[V]};return document.registerElement(W,{prototype:Object.create(HTMLElement.prototype,U)})},f.prototype.create=function(U){if(!U)throw new Error('missing options');if(!U.name)throw new Error('missing options.name');if(!U.template)throw new Error('missing options.template');var V=this;return V.name=U.name,V.model=U.model,V.modifiers=U.modifiers,V.controller=U.controller,V.currentScript=document._currentScript||document.currentScript,V.template=V._template(U.template),U.created&&(V.created=U.created.bind(V)),U.attached&&(V.attached=U.attached.bind(V)),U.detached&&(V.detached=U.detached.bind(V)),U.attributed&&(V.attributed=U.attributed.bind(V)),V.proto=V.define({name:V.name,attachedCallback:V.attached,detachedCallback:V.detached,attributeChangedCallback:V.attributed,createdCallback:function(){V.element=this,V.uuid=H(),V.element.appendChild(document.importNode(V.template.content,!0)),(V.model||V.controller)&&(V.binder=D({name:V.uuid,model:V.model,view:V.element,modifiers:V.modifiers},V.controller),V.model=V.binder.model),V.created&&V.created.call(V)}}),V};var K={has:function(U,V){return-1!==U.indexOf(V)},normalize:function(U){return U=decodeURI(U).replace(/\/{2,}/g,'/').replace(/\?.*/,'').replace(/\/$/,''),''===U?'/':U},getHash:function(U){return this.normalize(U.split('?')[0].split('#')[1]||'')},getSearch:function(U){return this.normalize(U.split('?')[1]||'')},getPath:function(U,V,W){return this.normalize(U.replace(window.location.origin,'/').replace(V,'/').replace(W,'/'))}};g.prototype.render=function(U){var V=this,W=null;return U.title&&(document.title=U.title),W='string'==typeof U.component?U.component in V.cache?V.cache[U.component]:V.cache[U.component]=document.createElement(U.component):U.component,V.view.firstChild&&V.view.removeChild(V.view.firstChild),V.view.appendChild(W),window.scroll(0,0),V},g.prototype.redirect=function(U){var V=this;return window.location=U.path,V},g.prototype.add=function(U){var V=this;return'Object'===U.constructor.name?V.routes.push(U):'Array'===U.constructor.name&&(V.routes=V.routes.concat(U)),V},g.prototype.remove=function(U){for(var W,V=this,X=0,Y=V.routes.length;X<Y;X++)if(W=V.routes[X],U===W.path){V.routes.splice(X,1);break}return V},g.prototype.get=function(U){var V=this,W=0,X=null,Y=V.routes.length;for(W;W<Y;W++)if(X=V.routes[W],!X.path)throw new Error('Router: missing path option');else if('string'==typeof X.path){if(X.path===U||X.path==='/'+U)return X;}else if('function'==typeof X.path&&X.path.test(U))return X;return X},g.prototype.change=function(U,V){var W=this;return W.mode?window.history[V?'replaceState':'pushState'](U,U.title,K.normalize(U.origin+U.path)):(W.isChangeEvent=!1,window.location=K.normalize(U.origin+U.path)),W},g.prototype.navigate=function(U,V){var W=this;return W.state.path=K.getPath(U.path,W.state.base,W.state.root),W.state.hash=K.getHash(W.state.path),W.state.search=K.getSearch(W.state.path),W.state.href=K.normalize(window.location.href),W.route=W.get(W.state.path),W.state.title=W.route.title,W.change(W.state,V),W.route.redirect?W.redirect(W.route):W.render(W.route),W},g.prototype.create=function(U){var V=this;return V.mode=U.mode,V.mode=null===V.mode||void 0===V.mode||V.mode,V.mode='history'in window&&'pushState'in window.history&&V.mode,V.base=U.base||'',V.routes=U.routes||[],V.external=U.external||'',V.cache={},V.isChangeEvent=!0,V.root=V.mode?'/':'/#',V.state={root:V.root,base:V.base,origin:K.normalize(V.base+V.root)},window.addEventListener('DOMContentLoaded',function(){V.view=document.querySelector('j-view')||document.querySelector('[j-view]'),V.navigate({path:window.location.href},!0)},!1),window.addEventListener(V.mode?'popstate':'hashchange',function(W){if(V.isChangeEvent){var X=V.mode?W.state:{path:W.newURL};V.navigate(X,!0)}else V.isChangeEvent=!0},!1),window.addEventListener('click',function(W){if(!(W.metaKey||W.ctrlKey||W.shiftKey)){for(var X=W.path?W.path[0]:W.target;X&&'A'!==X.nodeName;)X=X.parentNode;if(X&&'A'===X.nodeName){if(V.external){if('Function'===V.external.constructor.name&&V.external(X.href))return;if('RegExp'===V.external.constructor.name&&V.external.test(X.href))return;if('String'===V.external.constructor.name&&new RegExp(V.external).test(X.href))return}X.hasAttribute('download')||'external'===X.getAttribute('rel')||K.has(X.href,'mailto:')||K.has(X.href,'tel:')||K.has(X.href,'file:')||K.has(X.href,'ftp:')||(W.preventDefault(),V.navigate({path:X.href}))}}},!1),V};h.prototype.mime={html:'text/html',text:'text/plain',xml:'application/xml, text/xml',json:'application/json, text/javascript',urlencoded:'application/x-www-form-urlencoded',script:'text/javascript, application/javascript, application/x-javascript'},h.prototype.serialize=function(U){var V='';for(var W in U)V=0<V.length?V+'&':V,V=V+encodeURIComponent(W)+'='+encodeURIComponent(U[W]);return V},h.prototype.fetch=function(U){var V=this;if(!U)throw new Error('fetch: requires options');if(!U.action)throw new Error('fetch: requires options.action');if(U.method||(U.method='GET'),U.headers||(U.headers={}),U.data)if('GET'===U.method)U.action=U.action+'?'+V.serialize(U.data),U.data=null;else{switch(U.requestType=U.requestType?U.requestType.toLowerCase():'',U.responseType=U.responseType?U.responseType.toLowerCase():'',U.requestType){case'script':U.contentType=V.mime.script;break;case'json':U.contentType=V.self.mime.json;break;case'xml':U.contentType=V.mime.xm;break;case'html':U.contentType=V.mime.html;break;case'text':U.contentType=V.mime.text;break;default:U.contentType=V.mime.urlencoded;}switch(U.responseType){case'script':U.accept=V.mime.script;break;case'json':U.accept=V.mime.json;break;case'xml':U.accept=V.mime.xml;break;case'html':U.accept=V.mime.html;break;case'text':U.accept=V.mime.text;}U.contentType===V.mime.json&&(U.data=JSON.stringify(U.data)),U.contentType===V.mime.urlencoded&&(U.data=V.serialize(U.data))}var W=new XMLHttpRequest;if(W.open(U.method.toUpperCase(),U.action,!0,U.username,U.password),U.mimeType&&W.overrideMimeType(U.mimeType),U.withCredentials&&(W.withCredentials=U.withCredentials),U.accept&&(U.headers.Accept=U.accept),U.contentType&&(U.headers['Content-Type']=U.contentType),U.headers)for(var X in U.headers)W.setRequestHeader(X,U.headers[X]);W.onreadystatechange=function(){if(4===W.readyState)return 200<=W.status&&400>W.status?U.success(W):U.error(W)},W.send(U.data)},h.prototype.create=function(){var U=this;return U};var N=function(U){return new f().create(U)},Q=function(U){return new g().create(U)},S=n.sViewElement;document.registerElement(S,{prototype:Object.create(HTMLElement.prototype)});var T={services:{},http:function(){return new h().create()}(),component:function(U){return N(U)},binder:function(U,V){return D(U,V)},router:function(U){return this.router=Q(U)},query:function(U){return(document._currentScript||document.currentScript).ownerDocument.querySelector(U)},script:function(){return document._currentScript||document.currentScript},document:function(){return(document._currentScript||document.currentScript).ownerDocument}};return T});
